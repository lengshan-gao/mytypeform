# Serverless Framework配置 - 权重问卷系统
component: scf
name: survey-system

inputs:
  # 函数基本信息
  name: survey-system
  region: ap-guangzhou  # 请根据您的实际地域修改
  runtime: Nodejs16.13
  type: web
  
  # 资源规格
  memorySize: 1024
  timeout: 60
  
  # GitHub部署配置
  src:
    src: .
    exclude:
      - .git/**
      - .next/**
      - node_modules/**
      - .env.local
      - .env.development
      - public/uploads/**
      - prisma/dev.db
  
  # 环境变量（在部署时设置）
  environment:
    variables:
      NODE_ENV: production
      DATABASE_URL: ${env:DATABASE_URL}
      NEXTAUTH_SECRET: ${env:NEXTAUTH_SECRET}
      NEXTAUTH_URL: ${env:NEXTAUTH_URL}
  
  # API网关配置
  events:
    - apigw:
        parameters:
          protocols:
            - http
            - https
          environment: release
          endpoints:
            - path: /
              method: ANY
            - path: /{path}
              method: ANY
  
  # 构建配置
  installDependency: true
  buildCommand: |
    npm install
    npx prisma generate
    npm run build
  
  # 启动配置
  bootstrap: ./scf_bootstrap