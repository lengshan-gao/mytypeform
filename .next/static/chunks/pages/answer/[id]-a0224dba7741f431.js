(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[700],{7959:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/answer/[id]",function(){return r(9088)}])},9088:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(7568),i=r(4924),o=r(6042),s=r(9396),c=r(828),d=r(7582),l=r(5893),a=r(7294),u=r(1163);function f(){var e,t,r=(0,u.useRouter)(),f=r.query.id,m=(0,a.useState)(!0),h=m[0],p=m[1],y=(0,a.useState)(!1),g=y[0],b=y[1],x=(0,a.useState)(""),j=x[0],v=x[1],S=(0,a.useState)(""),w=S[0],k=S[1],_=(0,a.useState)(null),z=_[0],A=_[1],O=(0,a.useState)([]),I=O[0],C=O[1],B=(0,a.useState)({}),Z=B[0],R=B[1];(0,a.useEffect)(function(){f&&P()},[f]);var D,P=(t=(0,n.Z)(function(){var e,t,r;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,4,5]),p(!0),v(""),[4,fetch("/api/surveys/public?id=".concat(f))];case 1:return[4,e.sent().json()];case 2:return(t=e.sent()).success?(A(t.data.survey),C(t.data.questions||[]),r={},t.data.questions.forEach(function(e){"rating"===e.type?r[e.id]=3:"single_choice"===e.type?r[e.id]="":"multiple_choice"===e.type?r[e.id]=[]:r[e.id]=""}),R(r)):v(t.message||"获取问卷失败"),[3,5];case 3:return e.sent(),v("网络错误，请稍后重试"),[3,5];case 4:return p(!1),[7];case 5:return[2]}})}),function(){return t.apply(this,arguments)}),W=function(e,t){R(function(r){return(0,s.Z)((0,o.Z)({},r),(0,i.Z)({},e,t))})},E=(D=(0,n.Z)(function(e){var t,n,i,o,s,l,a,u,m,h;return(0,d.__generator)(this,function(d){switch(d.label){case 0:e.preventDefault(),d.label=1;case 1:d.trys.push([1,4,5,6]),b(!0),v(""),k(""),t=!0,n=!1,i=void 0;try{for(o=I[Symbol.iterator]();!(t=(s=o.next()).done);t=!0)if(!(a=Z[(l=s.value).id])||Array.isArray(a)&&0===a.length)return v("请回答问题：".concat(l.content)),[2]}catch(u){n=!0,i=u}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return[4,fetch("/api/surveys/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({surveyId:f,userId:"anonymous_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),answers:Object.entries(Z).map(function(e){var t=(0,c.Z)(e,2),r=t[0],n=t[1],i=I.find(function(e){return e.id===r});return(null==i?void 0:i.type)==="rating"?{questionId:r,score:"number"==typeof n?n:null,textAnswer:null,optionId:null}:(null==i?void 0:i.type)==="single_choice"?{questionId:r,score:null,textAnswer:null,optionId:"string"==typeof n?n:null}:{questionId:r,score:null,textAnswer:"string"==typeof n?n:null,optionId:null}})})})];case 2:return[4,d.sent().json()];case 3:return(h=d.sent()).success?(k("问卷提交成功！感谢您的参与。"),setTimeout(function(){r.push("/")},3e3)):v(h.message||"提交失败"),[3,6];case 4:return d.sent(),v("网络错误，请稍后重试"),[3,6];case 5:return b(!1),[7];case 6:return[2]}})}),function(e){return D.apply(this,arguments)});return h?(0,l.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⏳"}),(0,l.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem"},children:"加载问卷中..."})]})}):j?(0,l.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,l.jsxs)("div",{style:{textAlign:"center",background:"white",padding:"3rem",borderRadius:"1rem",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)",maxWidth:"500px",width:"90%"},children:[(0,l.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"❌"}),(0,l.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#dc2626",marginBottom:"1rem"},children:"加载失败"}),(0,l.jsx)("p",{style:{color:"#6b7280",fontSize:"1rem",lineHeight:"1.6",marginBottom:"2rem"},children:j}),(0,l.jsx)("button",{onClick:function(){return r.push("/")},style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"返回首页"})]})}):z?(0,l.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"2rem 1rem"},children:(0,l.jsxs)("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[w&&(0,l.jsxs)("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",color:"#16a34a",padding:"1.5rem",borderRadius:"0.75rem",marginBottom:"2rem",textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"✅"}),(0,l.jsx)("p",{style:{fontSize:"1.125rem",fontWeight:"500"},children:w})]}),j&&!w&&(0,l.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1.5rem"},children:j}),!w&&(0,l.jsxs)("form",{onSubmit:E,style:{background:"white",borderRadius:"1rem",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,l.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem",borderBottom:"2px solid #f3f4f6",paddingBottom:"1.5rem"},children:[(0,l.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",marginBottom:"0.5rem"},children:z.title}),z.description&&(0,l.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem",lineHeight:"1.6"},children:z.description})]}),(0,l.jsx)("div",{style:{marginBottom:"2rem"},children:I.map(function(e,t){return(0,l.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.75rem",padding:"1.5rem",marginBottom:"1.5rem",background:"#f9fafb"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:"1rem"},children:[(0,l.jsx)("span",{style:{background:"#3b82f6",color:"white",borderRadius:"50%",width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.875rem",fontWeight:"600",marginRight:"1rem",flexShrink:0},children:t+1}),(0,l.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1f2937",margin:0,lineHeight:"1.4"},children:e.content})]}),"rating"===e.type&&(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",flexWrap:"wrap"},children:[1,2,3,4,5].map(function(t){return(0,l.jsxs)("label",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer"},children:[(0,l.jsx)("input",{type:"radio",name:"question_".concat(e.id),value:t,checked:Z[e.id]===t,onChange:function(){return W(e.id,t)},style:{display:"none"}}),(0,l.jsx)("div",{style:{width:"3rem",height:"3rem",borderRadius:"50%",background:Z[e.id]===t?"#3b82f6":"#e5e7eb",color:Z[e.id]===t?"white":"#6b7280",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.125rem",fontWeight:"600",transition:"all 0.2s"},children:t}),(0,l.jsx)("span",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:1===t?"非常不满意":2===t?"不满意":3===t?"一般":4===t?"满意":"非常满意"})]},t)})}),"text"===e.type&&(0,l.jsx)("textarea",{value:Z[e.id]||"",onChange:function(t){return W(e.id,t.target.value)},placeholder:"请输入您的回答...",rows:4,style:{width:"100%",padding:"1rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"1rem",resize:"vertical",minHeight:"100px"}}),"single_choice"===e.type&&(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:e.options&&e.options.length>0?e.options.map(function(t,r){return(0,l.jsxs)("label",{style:{display:"flex",alignItems:"center",padding:"1rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",cursor:"pointer",background:Z[e.id]===(t.id||t)?"#f0f9ff":"white",borderColor:Z[e.id]===(t.id||t)?"#3b82f6":"#d1d5db",transition:"all 0.2s"},children:[(0,l.jsx)("input",{type:"radio",name:"question_".concat(e.id),value:t.id||t,checked:Z[e.id]===(t.id||t),onChange:function(){return W(e.id,t.id||t)},style:{marginRight:"0.75rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),(0,l.jsx)("span",{style:{fontSize:"1rem",color:"#374151"},children:t.content||t})]},t.id||r)}):(0,l.jsx)("div",{style:{padding:"1rem",background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"0.5rem",color:"#6b7280",textAlign:"center"},children:"暂无选项配置"})})]},e.id)})}),(0,l.jsx)("div",{style:{textAlign:"center"},children:(0,l.jsx)("button",{type:"submit",disabled:g,style:{background:g?"#9ca3af":"#10b981",color:"white",padding:"1rem 2rem",border:"none",borderRadius:"0.5rem",cursor:g?"not-allowed":"pointer",fontSize:"1.125rem",fontWeight:"600",minWidth:"200px"},children:g?"提交中...":"提交问卷"})})]}),(0,l.jsxs)("div",{style:{textAlign:"center",color:"#6b7280",fontSize:"0.875rem"},children:[(0,l.jsxs)("p",{children:["此问卷由 ",(null===(e=z.creator)||void 0===e?void 0:e.nickname)||"匿名用户"," 创建"]}),z.expiresAt&&(0,l.jsxs)("p",{children:["截止时间: ",new Date(z.expiresAt).toLocaleDateString("zh-CN")]})]})]})}):(0,l.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"\uD83D\uDCCB"}),(0,l.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem"},children:"问卷不存在"})]})})}},1163:function(e,t,r){e.exports=r(387)},943:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},7568:function(e,t,r){"use strict";function n(e,t,r,n,i,o,s){try{var c=e[o](s),d=c.value}catch(l){r(l);return}c.done?t(d):Promise.resolve(d).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function c(e){n(s,i,o,c,d,"next",e)}function d(e){n(s,i,o,c,d,"throw",e)}c(void 0)})}}r.d(t,{Z:function(){return i}})},3375:function(e,t,r){"use strict";function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}r.d(t,{Z:function(){return n}})},9396:function(e,t,r){"use strict";function n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}r.d(t,{Z:function(){return n}})},828:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(3375),i=r(1566);function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||(0,n.Z)(e,t)||(0,i.Z)(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1566:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(943);function i(e,t){if(e){if("string"==typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return(0,n.Z)(e,t)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=7959)}),_N_E=e.O()}]);