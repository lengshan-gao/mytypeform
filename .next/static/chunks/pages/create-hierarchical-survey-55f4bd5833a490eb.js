(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{4592:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/create-hierarchical-survey",function(){return t(2274)}])},2274:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var n=t(7568),i=t(6042),o=t(9396),d=t(9815),l=t(7582),c=t(5893),a=t(7294),s=t(1163);function u(){var e,r=(0,s.useRouter)(),t=(0,a.useState)(!1),u=t[0],m=t[1],f=(0,a.useState)(""),h=f[0],p=f[1],g=(0,a.useState)(""),b=g[0],y=g[1],x=(0,a.useState)(""),v=x[0],j=x[1],S=(0,a.useState)(""),w=S[0],Z=S[1],k=(0,a.useState)([]),z=k[0],B=k[1],C=function(){var e={id:Date.now().toString(),content:"",children:[]};B((0,d.Z)(z).concat([e]))},O=function(e){B(z.filter(function(r){return r.id!==e}))},R=function(e){var r={id:Date.now().toString(),content:"",options:[{id:"1",content:"",score:0,weight:1},{id:"2",content:"",score:0,weight:1},{id:"3",content:"",score:0,weight:1}]};B(z.map(function(t){return t.id===e?(0,o.Z)((0,i.Z)({},t),{children:(0,d.Z)(t.children).concat([r])}):t}))},W=function(e,r){B(z.map(function(t){return t.id===e?(0,o.Z)((0,i.Z)({},t),{children:t.children.filter(function(e){return e.id!==r})}):t}))},_=function(e,r,t,n){B(z.map(function(d){return d.id===e?(0,o.Z)((0,i.Z)({},d),{children:d.children.map(function(e){return e.id===r?(0,o.Z)((0,i.Z)({},e),{options:e.options.map(function(e){return e.id===t?(0,o.Z)((0,i.Z)({},e),{content:n}):e})}):e})}):d}))},A=function(e,r,t,n){B(z.map(function(d){return d.id===e?(0,o.Z)((0,i.Z)({},d),{children:d.children.map(function(e){return e.id===r?(0,o.Z)((0,i.Z)({},e),{options:e.options.map(function(e){return e.id===t?(0,o.Z)((0,i.Z)({},e),{score:n}):e})}):e})}):d}))},P=function(e,r,t,n){B(z.map(function(d){return d.id===e?(0,o.Z)((0,i.Z)({},d),{children:d.children.map(function(e){return e.id===r?(0,o.Z)((0,i.Z)({},e),{options:e.options.map(function(e){return e.id===t?(0,o.Z)((0,i.Z)({},e),{weight:n}):e})}):e})}):d}))},I=function(){if(!b.trim())return p("问卷标题不能为空"),!1;if(0===z.length)return p("至少需要一个大问题"),!1;var e=!0,r=!1,t=void 0;try{for(var n,i=z[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;if(!o.content.trim())return p("大问题内容不能为空"),!1;if(0===o.children.length)return p("每个大问题下至少需要一个小问题"),!1;var d=!0,l=!1,c=void 0;try{for(var a,s=o.children[Symbol.iterator]();!(d=(a=s.next()).done);d=!0){var u=a.value;if(!u.content.trim())return p("小问题内容不能为空"),!1;var m=!0,f=!1,h=void 0;try{for(var g,y=u.options[Symbol.iterator]();!(m=(g=y.next()).done);m=!0){var x=g.value;if(!x.content.trim())return p("选项内容不能为空"),!1;if(x.score<=0)return p("选项分值必须大于0"),!1;if(x.weight<.1||x.weight>2)return p("选项权重必须在0.1到2之间"),!1}}catch(v){f=!0,h=v}finally{try{m||null==y.return||y.return()}finally{if(f)throw h}}}}catch(j){l=!0,c=j}finally{try{d||null==s.return||s.return()}finally{if(l)throw c}}}}catch(S){r=!0,t=S}finally{try{e||null==i.return||i.return()}finally{if(r)throw t}}return!0},E=(e=(0,n.Z)(function(e){var t,n,i;return(0,l.__generator)(this,function(n){switch(n.label){case 0:if(e.preventDefault(),!I())return[2];n.label=1;case 1:if(n.trys.push([1,4,5,6]),m(!0),p(""),!(t=localStorage.getItem("token")))return p("请先登录"),r.push("/login"),[2];return[4,fetch("/api/surveys/create-hierarchical",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({title:b.trim(),description:v.trim(),expiresAt:w||null,groups:z})})];case 2:return[4,n.sent().json()];case 3:return(i=n.sent()).success?(alert("层级问卷创建成功！"),r.push("/surveys")):p(i.message||"创建失败"),[3,6];case 4:return n.sent(),p("网络错误，请稍后重试"),[3,6];case 5:return m(!1),[7];case 6:return[2]}})}),function(r){return e.apply(this,arguments)});return(0,c.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"2rem 0"},children:(0,c.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",background:"white",borderRadius:"0.75rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"2rem"},children:[(0,c.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",marginBottom:"2rem",textAlign:"center"},children:"创建层级问卷"}),h&&(0,c.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:h}),(0,c.jsxs)("form",{onSubmit:E,children:[(0,c.jsxs)("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"0.5rem",marginBottom:"2rem"},children:[(0,c.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem"},children:"基本信息"}),(0,c.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷标题 *"}),(0,c.jsx)("input",{type:"text",value:b,onChange:function(e){return y(e.target.value)},placeholder:"请输入问卷标题",required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,c.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷描述"}),(0,c.jsx)("textarea",{value:v,onChange:function(e){return j(e.target.value)},placeholder:"请输入问卷描述",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem",resize:"vertical"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"截止时间"}),(0,c.jsx)("input",{type:"datetime-local",value:w,onChange:function(e){return Z(e.target.value)},style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]})]}),(0,c.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,c.jsxs)("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937"},children:["大问题配置 (",z.length,")"]}),(0,c.jsx)("button",{type:"button",onClick:C,style:{background:"#10b981",color:"white",padding:"0.5rem 1rem",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"+ 添加大问题"})]}),0===z.length?(0,c.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280",background:"#f9fafb",borderRadius:"0.5rem",border:"1px dashed #d1d5db"},children:'暂无大问题，点击"添加大问题"开始配置'}):z.map(function(e,r){return(0,c.jsxs)("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"0.5rem",marginBottom:"1rem",border:"1px solid #e5e7eb"},children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,c.jsxs)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1f2937"},children:["大问题 ",r+1]}),(0,c.jsx)("button",{type:"button",onClick:function(){return O(e.id)},style:{background:"#ef4444",color:"white",padding:"0.25rem 0.5rem",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"删除"})]}),(0,c.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"大问题内容 *"}),(0,c.jsx)("input",{type:"text",value:e.content,onChange:function(r){B(z.map(function(t){return t.id===e.id?(0,o.Z)((0,i.Z)({},t),{content:r.target.value}):t}))},placeholder:"请输入大问题内容",required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,c.jsxs)("h4",{style:{fontSize:"1rem",fontWeight:"600",color:"#374151"},children:["小问题配置 (",e.children.length,")"]}),(0,c.jsx)("button",{type:"button",onClick:function(){return R(e.id)},style:{background:"#3b82f6",color:"white",padding:"0.25rem 0.75rem",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"+ 添加小问题"})]}),e.children.map(function(r,t){return(0,c.jsxs)("div",{style:{background:"white",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1rem",border:"1px solid #e5e7eb"},children:[(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,c.jsxs)("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:["小问题 ",t+1]}),(0,c.jsx)("button",{type:"button",onClick:function(){return W(e.id,r.id)},style:{background:"#ef4444",color:"white",padding:"0.25rem 0.5rem",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"删除"})]}),(0,c.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.75rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"小问题内容 *"}),(0,c.jsx)("input",{type:"text",value:r.content,onChange:function(t){B(z.map(function(n){return n.id===e.id?(0,o.Z)((0,i.Z)({},n),{children:n.children.map(function(e){return e.id===r.id?(0,o.Z)((0,i.Z)({},e),{content:t.target.value}):e})}):n}))},placeholder:"请输入小问题内容",required:!0,style:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.875rem"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h6",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem"},children:"选项配置 (3个选项)"}),r.options.map(function(t,n){return(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 100px 100px",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"end"},children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{style:{display:"block",fontSize:"0.625rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.25rem"},children:["选项 ",n+1," 内容 *"]}),(0,c.jsx)("input",{type:"text",value:t.content,onChange:function(n){return _(e.id,r.id,t.id,n.target.value)},placeholder:"选项内容",required:!0,style:{width:"100%",padding:"0.375rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.75rem"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.625rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.25rem"},children:"分值 *"}),(0,c.jsx)("input",{type:"number",value:t.score,onChange:function(n){return A(e.id,r.id,t.id,parseFloat(n.target.value))},placeholder:"分值",min:"0",step:"1",required:!0,style:{width:"100%",padding:"0.375rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.75rem"}})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{style:{display:"block",fontSize:"0.625rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.25rem"},children:"权重 *"}),(0,c.jsx)("input",{type:"number",value:t.weight,onChange:function(n){return P(e.id,r.id,t.id,parseFloat(n.target.value))},placeholder:"权重",min:"0.1",max:"2",step:"0.1",required:!0,style:{width:"100%",padding:"0.375rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.75rem"}})]})]},t.id)})]})]},r.id)})]})]},e.id)})]}),(0,c.jsx)("div",{style:{textAlign:"center"},children:(0,c.jsx)("button",{type:"submit",disabled:u,style:{background:u?"#9ca3af":"#10b981",color:"white",padding:"1rem 2rem",border:"none",borderRadius:"0.5rem",cursor:u?"not-allowed":"pointer",fontSize:"1.125rem",fontWeight:"600",minWidth:"200px"},children:u?"创建中...":"创建层级问卷"})})]})]})})}},1163:function(e,r,t){e.exports=t(387)},943:function(e,r,t){"use strict";function n(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}t.d(r,{Z:function(){return n}})},7568:function(e,r,t){"use strict";function n(e,r,t,n,i,o,d){try{var l=e[o](d),c=l.value}catch(a){t(a);return}l.done?r(c):Promise.resolve(c).then(n,i)}function i(e){return function(){var r=this,t=arguments;return new Promise(function(i,o){var d=e.apply(r,t);function l(e){n(d,i,o,l,c,"next",e)}function c(e){n(d,i,o,l,c,"throw",e)}l(void 0)})}}t.d(r,{Z:function(){return i}})},3375:function(e,r,t){"use strict";function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}t.d(r,{Z:function(){return n}})},9396:function(e,r,t){"use strict";function n(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):(function(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t})(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}t.d(r,{Z:function(){return n}})},9815:function(e,r,t){"use strict";t.d(r,{Z:function(){return d}});var n=t(943),i=t(3375),o=t(1566);function d(e){return function(e){if(Array.isArray(e))return(0,n.Z)(e)}(e)||(0,i.Z)(e)||(0,o.Z)(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1566:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(943);function i(e,r){if(e){if("string"==typeof e)return(0,n.Z)(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return(0,n.Z)(e,r)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4592)}),_N_E=e.O()}]);