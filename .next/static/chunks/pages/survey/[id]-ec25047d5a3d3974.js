(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{8512:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/survey/[id]",function(){return t(1371)}])},1371:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return l}});var i=t(7568),n=t(7582),o=t(5893),s=t(7294),d=t(1163);function l(){var e,r,t,l,a=(0,d.useRouter)(),c=a.query.id,m=(0,s.useState)(!0),u=m[0],h=m[1],f=(0,s.useState)(""),g=f[0],x=f[1],p=(0,s.useState)(null),y=p[0],b=p[1],j=(0,s.useState)([]),v=j[0],S=j[1],z=(0,s.useState)([]),w=z[0],B=z[1],C=(0,s.useState)({loading:!1,error:"",data:null}),k=C[0],R=C[1];(0,s.useEffect)(function(){c&&W()},[c]);var A,W=(l=(0,i.Z)(function(){var e,r,t;return(0,n.__generator)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,3,4,5]),h(!0),!(e=localStorage.getItem("token")))return x("请先登录后再查看问卷详情"),h(!1),setTimeout(function(){a.push("/login?returnTo="+a.asPath)},2e3),[2];return[4,fetch("/api/surveys/detail?id=".concat(c),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})];case 1:return[4,r.sent().json()];case 2:return(t=r.sent()).success?(b(t.data.survey),S(t.data.questions||[]),B(t.data.responses||[])):x(t.message||"获取问卷详情失败"),[3,5];case 3:return r.sent(),x("网络错误，请稍后重试"),[3,5];case 4:return h(!1),[7];case 5:return[2]}})}),function(){return l.apply(this,arguments)}),_=function(e){var r=new Date(e);return r.toLocaleDateString("zh-CN")+" "+r.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})},D=function(){a.back()},I=(A=(0,i.Z)(function(){var e,r,t;return(0,n.__generator)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),R({loading:!0,error:"",data:null}),!(e=localStorage.getItem("token")))return R({loading:!1,error:"请先登录后再计算权重得分",data:null}),[2];return[4,fetch("/api/surveys/calculate-weight?surveyId=".concat(c),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})];case 1:return[4,r.sent().json()];case 2:return(t=r.sent()).success?R({loading:!1,error:"",data:t.data}):R({loading:!1,error:t.message||"计算权重得分失败",data:null}),[3,4];case 3:return r.sent(),R({loading:!1,error:"网络错误，请稍后重试",data:null}),[3,4];case 4:return[2]}})}),function(){return A.apply(this,arguments)});if(u)return(0,o.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),(0,o.jsx)("p",{style:{color:"#6b7280"},children:"加载中..."})]})});if(g)return(0,o.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"❌"}),(0,o.jsx)("h3",{style:{color:"#ef4444",marginBottom:"1rem"},children:"加载失败"}),(0,o.jsx)("p",{style:{color:"#6b7280",marginBottom:"2rem"},children:g}),(0,o.jsx)("button",{onClick:D,style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"返回列表"})]})});if(!y)return(0,o.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\uD83D\uDCCB"}),(0,o.jsx)("h3",{style:{color:"#374151",marginBottom:"1rem"},children:"问卷不存在"}),(0,o.jsx)("button",{onClick:D,style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"返回列表"})]})});return(0,o.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",fontFamily:"sans-serif"},children:(0,o.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"2rem 1rem"},children:[(0,o.jsx)("button",{onClick:D,style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"1rem",marginBottom:"2rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"← 返回问卷列表"}),(0,o.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[(0,o.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",margin:0,flex:1},children:y.title}),(0,o.jsx)("span",{style:{background:{DRAFT:"#6b7280",PUBLISHED:"#10b981",PAUSED:"#f59e0b",CLOSED:"#ef4444",active:"#3b82f6"}[r=y.status]||"#6b7280",color:"white",padding:"0.5rem 1rem",borderRadius:"1rem",fontSize:"0.875rem",fontWeight:"500"},children:{DRAFT:"草稿",PUBLISHED:"已发布",PAUSED:"已暂停",CLOSED:"已关闭",active:"活跃"}[t=y.status]||t})]}),y.description&&(0,o.jsx)("p",{style:{color:"#6b7280",marginBottom:"1.5rem",fontSize:"1rem",lineHeight:"1.6"},children:y.description}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"创建时间"}),(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#1f2937"},children:_(y.createdAt)})]}),y.expiresAt&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"截止时间"}),(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#1f2937"},children:_(y.expiresAt)})]})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,o.jsx)("button",{onClick:function(){return a.push("/surveys")},style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",background:"white",color:"#374151",cursor:"pointer"},children:"返回列表"}),(0,o.jsx)("button",{onClick:function(){return a.push("/edit-survey?id=".concat(y.id))},style:{padding:"0.75rem 1.5rem",border:"1px solid #3b82f6",borderRadius:"0.375rem",background:"white",color:"#3b82f6",cursor:"pointer"},children:"编辑问卷"}),(0,o.jsx)("button",{onClick:function(){var e="".concat(window.location.origin,"/answer/").concat(y.id);navigator.clipboard.writeText(e),alert("链接已复制到剪贴板")},style:{padding:"0.75rem 1.5rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"复制链接"})]})]}),(0,o.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,o.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1.5rem"},children:["问题列表 (",v.length,")"]}),0===v.length?(0,o.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"暂无问题"}):(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:v.map(function(e,r){return(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"1rem"},children:[(0,o.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:(0,o.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#1f2937",margin:0},children:[r+1,". ",e.content]})}),(0,o.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["类型: ","rating"===e.type?"评分题":"single_choice"===e.type?"单选题":"GROUP"===e.type?"大问题":e.type]})]},e.id)})})]}),(0,o.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem"},children:[(0,o.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1.5rem"},children:["回答统计 (",w.length,")"]}),0===w.length?(0,o.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"暂无回答"}):(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"总回答数"}),(0,o.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:w.length})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"平均完成时间"}),(0,o.jsxs)("div",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#10b981"},children:[w.length>0?Math.round(w.reduce(function(e,r){return e+30},0)/w.length):0,"秒"]})]})]})]}),(0,o.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginTop:"2rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,o.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937"},children:"权重计算结果"}),(0,o.jsx)("button",{onClick:I,style:{background:"#3b82f6",color:"white",padding:"0.5rem 1rem",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"重新计算"})]}),k.loading?(0,o.jsxs)("div",{style:{textAlign:"center",padding:"2rem"},children:[(0,o.jsx)("div",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:"⏳"}),(0,o.jsx)("p",{style:{color:"#6b7280"},children:"计算中..."})]}):k.error?(0,o.jsxs)("div",{style:{textAlign:"center",padding:"2rem",background:"#fef2f2",borderRadius:"0.5rem",border:"1px solid #fecaca"},children:[(0,o.jsx)("div",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:"❌"}),(0,o.jsx)("p",{style:{color:"#dc2626"},children:k.error})]}):k.data?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[(0,o.jsxs)("div",{style:{background:"#f0f9ff",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #bae6fd"},children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#0369a1",marginBottom:"0.5rem"},children:"总回答数"}),(0,o.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#0369a1"},children:k.data.totalResponses})]}),(0,o.jsxs)("div",{style:{background:"#f0fdf4",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #bbf7d0"},children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#15803d",marginBottom:"0.5rem"},children:"项目总数"}),(0,o.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#15803d"},children:k.data.calculationResults.length})]})]}),(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem"},children:"各项目得分详情"}),k.data.calculationResults.map(function(e,r){return(0,o.jsxs)("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"0.5rem",marginBottom:"1rem",border:"1px solid #e5e7eb"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h4",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1f2937",marginBottom:"0.5rem"},children:[r+1,". ",e.questionContent]}),(0,o.jsx)("div",{style:{display:"flex",gap:"1rem",fontSize:"0.875rem",color:"#6b7280"},children:(0,o.jsxs)("span",{children:["类型: ","single_choice"===e.type?"单选题":"评分题"]})})]}),(0,o.jsxs)("div",{style:{textAlign:"right"},children:[(0,o.jsx)("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#3b82f6"},children:"single_choice"===e.type?e.totalScore.toFixed(1):e.weightedScore.toFixed(1)}),(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"得分"})]})]}),"single_choice"===e.type&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"选项统计:"}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:e.optionStats.map(function(e){return(0,o.jsxs)("div",{style:{background:"white",padding:"0.75rem",borderRadius:"0.25rem",border:"1px solid #e5e7eb"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[(0,o.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:e.optionContent}),(0,o.jsxs)("span",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#059669"},children:[e.score,"分"]})]}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"#6b7280"},children:[(0,o.jsxs)("span",{children:["选择: ",e.selectionCount,"次"]}),(0,o.jsxs)("span",{children:[(100*e.selectionRate).toFixed(1),"%"]})]})]},e.optionId)})})]}),"rating"===e.type&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:"评分分布:"}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(100px, 1fr))",gap:"0.5rem"},children:e.ratingStats.scoreDistribution.map(function(e){return(0,o.jsxs)("div",{style:{background:"white",padding:"0.5rem",borderRadius:"0.25rem",border:"1px solid #e5e7eb",textAlign:"center"},children:[(0,o.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:[e.score,"分"]}),(0,o.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:[e.count,"次 (",(100*e.rate).toFixed(1),"%)"]})]},e.score)})})]})]},e.questionId)})]}),(0,o.jsxs)("div",{style:{background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",color:"white",padding:"2rem",borderRadius:"0.75rem",textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",opacity:.9,marginBottom:"0.5rem"},children:"问卷总得分"}),(0,o.jsx)("div",{style:{fontSize:"3rem",fontWeight:"700",marginBottom:"0.5rem"},children:(e=k.data.calculationResults,e.reduce(function(e,r){return"single_choice"===r.type?e+r.totalScore:"rating"===r.type?e+r.weightedScore:e},0)).toFixed(1)}),(0,o.jsx)("div",{style:{fontSize:"1rem",opacity:.9},children:"基于权重计算的综合得分"})]})]}):(0,o.jsxs)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:[(0,o.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"\uD83D\uDCCA"}),(0,o.jsx)("p",{children:'点击"重新计算"按钮查看权重计算结果'})]})]})]})})}},1163:function(e,r,t){e.exports=t(387)},7568:function(e,r,t){"use strict";function i(e,r,t,i,n,o,s){try{var d=e[o](s),l=d.value}catch(a){t(a);return}d.done?r(l):Promise.resolve(l).then(i,n)}function n(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var s=e.apply(r,t);function d(e){i(s,n,o,d,l,"next",e)}function l(e){i(s,n,o,d,l,"throw",e)}d(void 0)})}}t.d(r,{Z:function(){return n}})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8512)}),_N_E=e.O()}]);