(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{6942:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/answer-hierarchical/[id]",function(){return r(9875)}])},9875:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7568),i=r(4924),o=r(6042),s=r(9396),c=r(7582),d=r(5893),l=r(7294),a=r(1163);function u(){var e,t,r=(0,a.useRouter)(),u=r.query.id,f=(0,l.useState)(!0),h=f[0],m=f[1],p=(0,l.useState)(!1),y=p[0],g=p[1],b=(0,l.useState)(""),x=b[0],j=b[1],v=(0,l.useState)(""),w=v[0],S=v[1],k=(0,l.useState)(null),z=k[0],O=k[1],_=(0,l.useState)([]),R=_[0],B=_[1],C=(0,l.useState)({}),D=C[0],P=C[1];(0,l.useEffect)(function(){u&&W()},[u]);var I,W=(t=(0,n.Z)(function(){var e,t,r,n;return(0,c.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,4,5]),m(!0),j(""),[4,fetch("/api/surveys/public?id=".concat(u))];case 1:return[4,e.sent().json()];case 2:return(t=e.sent()).success?(O(t.data.survey),B(r=t.data.questions.filter(function(e){return"GROUP"===e.type})),n={},r.forEach(function(e){e.children.forEach(function(e){n[e.id]=""})}),P(n)):j(t.message||"获取问卷失败"),[3,5];case 3:return e.sent(),j("网络错误，请稍后重试"),[3,5];case 4:return m(!1),[7];case 5:return[2]}})}),function(){return t.apply(this,arguments)}),E=function(e,t){P(function(r){return(0,s.Z)((0,o.Z)({},r),(0,i.Z)({},e,t))})},A=(I=(0,n.Z)(function(e){var t,n,i,o,s,d,l,a,f,h,m,p,y,b,x,v,w,k,z,O,_,B,C,P,I,W,E,A,N;return(0,c.__generator)(this,function(c){switch(c.label){case 0:e.preventDefault(),c.label=1;case 1:c.trys.push([1,4,5,6]),g(!0),j(""),S(""),t=!0,n=!1,i=void 0;try{for(o=R[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){d=s.value,l=!0,a=!1,f=void 0;try{for(h=d.children[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)if(!D[(p=m.value).id])return j("请回答问题：".concat(p.content)),[2]}catch(y){a=!0,f=y}finally{try{l||null==h.return||h.return()}finally{if(a)throw f}}}}catch(A){n=!0,i=A}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}b="anonymous_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),x=[],v=!0,w=!1,k=void 0;try{for(z=R[Symbol.iterator]();!(v=(O=z.next()).done);v=!0){_=O.value,B=!0,C=!1,P=void 0;try{for(I=_.children[Symbol.iterator]();!(B=(W=I.next()).done);B=!0)E=W.value,x.push({questionId:E.id,optionId:D[E.id]})}catch(T){C=!0,P=T}finally{try{B||null==I.return||I.return()}finally{if(C)throw P}}}}catch(Z){w=!0,k=Z}finally{try{v||null==z.return||z.return()}finally{if(w)throw k}}return[4,fetch("/api/surveys/submit-hierarchical",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({surveyId:u,userId:b,answers:x})})];case 2:return[4,c.sent().json()];case 3:return(N=c.sent()).success?(S("问卷提交成功！感谢您的参与。"),setTimeout(function(){r.push("/")},3e3)):j(N.message||"提交失败"),[3,6];case 4:return c.sent(),j("网络错误，请稍后重试"),[3,6];case 5:return g(!1),[7];case 6:return[2]}})}),function(e){return I.apply(this,arguments)});return h?(0,d.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"⏳"}),(0,d.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem"},children:"加载问卷中..."})]})}):x?(0,d.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,d.jsxs)("div",{style:{textAlign:"center",background:"white",padding:"3rem",borderRadius:"1rem",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)",maxWidth:"500px",width:"90%"},children:[(0,d.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"❌"}),(0,d.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#dc2626",marginBottom:"1rem"},children:"加载失败"}),(0,d.jsx)("p",{style:{color:"#6b7280",fontSize:"1rem",lineHeight:"1.6",marginBottom:"2rem"},children:x}),(0,d.jsx)("button",{onClick:function(){return r.push("/")},style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"返回首页"})]})}):z?(0,d.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"2rem 0"},children:(0,d.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",background:"white",borderRadius:"0.75rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"2rem"},children:[(0,d.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[(0,d.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",marginBottom:"1rem"},children:z.title}),z.description&&(0,d.jsx)("p",{style:{fontSize:"1.125rem",color:"#6b7280",lineHeight:"1.6"},children:z.description})]}),x&&(0,d.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:x}),w&&(0,d.jsx)("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",color:"#15803d",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:w}),(0,d.jsxs)("form",{onSubmit:A,children:[R.map(function(e,t){return(0,d.jsxs)("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"0.5rem",marginBottom:"2rem",border:"1px solid #e5e7eb"},children:[(0,d.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,d.jsx)("span",{style:{background:"#3b82f6",color:"white",borderRadius:"50%",width:"2rem",height:"2rem",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1rem",fontWeight:"600"},children:t+1}),e.content]}),e.children.map(function(e,t){return(0,d.jsxs)("div",{style:{background:"white",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem",border:"1px solid #e5e7eb"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[(0,d.jsx)("span",{style:{background:"#10b981",color:"white",borderRadius:"50%",width:"1.5rem",height:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.875rem",fontWeight:"600"},children:t+1}),(0,d.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1f2937",margin:0},children:e.content})]}),(0,d.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:e.options.map(function(t){return(0,d.jsxs)("label",{style:{display:"flex",alignItems:"center",padding:"1rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",cursor:"pointer",background:D[e.id]===t.id?"#f0f9ff":"white",borderColor:D[e.id]===t.id?"#3b82f6":"#d1d5db",transition:"all 0.2s"},children:[(0,d.jsx)("input",{type:"radio",name:"question_".concat(e.id),value:t.id,checked:D[e.id]===t.id,onChange:function(){return E(e.id,t.id)},style:{marginRight:"0.75rem",width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsx)("span",{style:{fontSize:"1rem",color:"#374151",fontWeight:"500"},children:t.content}),(0,d.jsxs)("div",{style:{display:"flex",gap:"1rem",fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:[(0,d.jsxs)("span",{children:["分值: ",t.score]}),(0,d.jsxs)("span",{children:["权重: ",t.weight]})]})]})]},t.id)})})]},e.id)})]},e.id)}),(0,d.jsx)("div",{style:{textAlign:"center"},children:(0,d.jsx)("button",{type:"submit",disabled:y,style:{background:y?"#9ca3af":"#10b981",color:"white",padding:"1rem 2rem",border:"none",borderRadius:"0.5rem",cursor:y?"not-allowed":"pointer",fontSize:"1.125rem",fontWeight:"600",minWidth:"200px"},children:y?"提交中...":"提交问卷"})})]}),(0,d.jsxs)("div",{style:{textAlign:"center",color:"#6b7280",fontSize:"0.875rem",marginTop:"2rem"},children:[(0,d.jsxs)("p",{children:["此问卷由 ",(null===(e=z.creator)||void 0===e?void 0:e.nickname)||"匿名用户"," 创建"]}),z.expiresAt&&(0,d.jsxs)("p",{children:["截止时间: ",new Date(z.expiresAt).toLocaleDateString("zh-CN")]})]})]})}):(0,d.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"\uD83D\uDCDD"}),(0,d.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem"},children:"问卷不存在"})]})})}},1163:function(e,t,r){e.exports=r(387)},7568:function(e,t,r){"use strict";function n(e,t,r,n,i,o,s){try{var c=e[o](s),d=c.value}catch(l){r(l);return}c.done?t(d):Promise.resolve(d).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function c(e){n(s,i,o,c,d,"next",e)}function d(e){n(s,i,o,c,d,"throw",e)}c(void 0)})}}r.d(t,{Z:function(){return i}})},9396:function(e,t,r){"use strict";function n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}r.d(t,{Z:function(){return n}})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=6942)}),_N_E=e.O()}]);