(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{9934:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/edit-survey",function(){return r(2549)}])},2549:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var n=r(7568),i=r(4924),o=r(6042),s=r(9396),a=r(9815),d=r(7582),u=r(5893),c=r(7294),l=r(1163);function m(){var e,t=(0,l.useRouter)(),r=t.query.id,m=(0,c.useState)(!0),f=m[0],p=m[1],h=(0,c.useState)(!1),y=h[0],b=h[1],g=(0,c.useState)(""),x=g[0],j=g[1],v=(0,c.useState)(""),S=v[0],w=v[1],k=(0,c.useState)({title:"",description:"",expiresAt:"",status:"DRAFT",questions:[]}),Z=k[0],B=k[1];(0,c.useEffect)(function(){r&&O()},[r]);var C,O=(e=(0,n.Z)(function(){var e,i,o,s,a,u,c;return(0,d.__generator)(this,function(i){switch(i.label){case 0:if(i.trys.push([0,6,7,8]),p(!0),!(e=localStorage.getItem("token")))return j("请先登录"),t.push("/login?returnTo=/edit-survey/"+r),[2];return[4,fetch("/api/surveys/detail?id=".concat(r),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})];case 1:return[4,i.sent().json()];case 2:var u;if(!(o=i.sent()).success)return[3,4];return a=(s=o.data).survey,[4,Promise.all((0,s.questions).map((u=(0,n.Z)(function(e){var t,r;return(0,d.__generator)(this,function(t){switch(t.label){case 0:return[4,fetch("/api/surveys/question-options?questionId=".concat(e.id))];case 1:return[4,t.sent().json()];case 2:return r=t.sent(),[2,{id:e.id,content:e.content,type:e.type,imageUrl:e.imageUrl||"",order:e.order,options:r.success?r.data.options:[]}]}})}),function(e){return u.apply(this,arguments)})))];case 3:return c=i.sent(),B({title:a.title||"",description:a.description||"",expiresAt:a.expiresAt?new Date(a.expiresAt).toISOString().slice(0,16):"",status:a.status||"DRAFT",questions:c}),[3,5];case 4:j(o.message||"获取问卷数据失败"),i.label=5;case 5:return[3,8];case 6:return i.sent(),j("网络错误，请稍后重试"),[3,8];case 7:return p(!1),[7];case 8:return[2]}})}),function(){return e.apply(this,arguments)}),z=function(e){var t=e.target,r=t.name,n=t.value;B(function(e){return(0,s.Z)((0,o.Z)({},e),(0,i.Z)({},r,n))})},_=function(e,t,r){B(function(n){return(0,s.Z)((0,o.Z)({},n),{questions:n.questions.map(function(n,a){return a===e?(0,s.Z)((0,o.Z)({},n),(0,i.Z)({},t,r)):n})})})},A=function(){B(function(e){return(0,s.Z)((0,o.Z)({},e),{questions:(0,a.Z)(e.questions).concat([{id:"",content:"",type:"rating",imageUrl:"",order:e.questions.length,options:[]}])})})},R=function(e){if(Z.questions.length<=1){alert("问卷至少需要一个问题");return}B(function(t){return(0,s.Z)((0,o.Z)({},t),{questions:t.questions.filter(function(t,r){return r!==e})})})},q=(C=(0,n.Z)(function(e){var n,i,s;return(0,d.__generator)(this,function(i){switch(i.label){case 0:e.preventDefault(),i.label=1;case 1:if(i.trys.push([1,4,5,6]),b(!0),j(""),w(""),!(n=localStorage.getItem("token")))return j("请先登录"),[2];return[4,fetch("/api/surveys/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify((0,o.Z)({surveyId:r},Z))})];case 2:return[4,i.sent().json()];case 3:return(s=i.sent()).success?(w("问卷更新成功！"),setTimeout(function(){t.push("/surveys")},1500)):j(s.message||"更新问卷失败"),[3,6];case 4:return i.sent(),j("网络错误，请稍后重试"),[3,6];case 5:return b(!1),[7];case 6:return[2]}})}),function(e){return C.apply(this,arguments)});return f?(0,u.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)("div",{children:"加载中..."})}):(0,u.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"2rem"},children:(0,u.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:[(0,u.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937"},children:"编辑问卷"}),(0,u.jsx)("button",{onClick:function(){return t.back()},style:{padding:"0.5rem 1rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",background:"white",color:"#374151",cursor:"pointer"},children:"返回"})]}),x&&(0,u.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:x}),S&&(0,u.jsx)("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",color:"#16a34a",padding:"1rem",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:S}),(0,u.jsxs)("form",{onSubmit:q,style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem"},children:[(0,u.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,u.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem"},children:"基本信息"}),(0,u.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷标题 *"}),(0,u.jsx)("input",{type:"text",name:"title",value:Z.title,onChange:z,required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,u.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷描述"}),(0,u.jsx)("textarea",{name:"description",value:Z.description,onChange:z,rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem",resize:"vertical"}})]}),(0,u.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"截止时间"}),(0,u.jsx)("input",{type:"datetime-local",name:"expiresAt",value:Z.expiresAt,onChange:z,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"状态"}),(0,u.jsxs)("select",{name:"status",value:Z.status,onChange:z,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"},children:[(0,u.jsx)("option",{value:"DRAFT",children:"草稿"}),(0,u.jsx)("option",{value:"PUBLISHED",children:"已发布"}),(0,u.jsx)("option",{value:"PAUSED",children:"已暂停"}),(0,u.jsx)("option",{value:"CLOSED",children:"已关闭"})]})]})]}),(0,u.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[(0,u.jsxs)("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937"},children:["问题列表 (",Z.questions.length,")"]}),(0,u.jsx)("button",{type:"button",onClick:A,style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"添加问题"})]}),Z.questions.map(function(e,t){return(0,u.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"1.5rem",marginBottom:"1rem",background:"#f9fafb"},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[(0,u.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#1f2937"},children:["问题 ",t+1]}),(0,u.jsx)("button",{type:"button",onClick:function(){return R(t)},style:{padding:"0.25rem 0.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.875rem"},children:"删除"})]}),(0,u.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问题内容 *"}),(0,u.jsx)("input",{type:"text",value:e.content,onChange:function(e){return _(t,"content",e.target.value)},required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,u.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问题类型"}),(0,u.jsxs)("select",{value:e.type,onChange:function(e){return _(t,"type",e.target.value)},style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"},children:[(0,u.jsx)("option",{value:"rating",children:"评分题"}),(0,u.jsx)("option",{value:"single_choice",children:"单选题"}),(0,u.jsx)("option",{value:"multiple_choice",children:"多选题"}),(0,u.jsx)("option",{value:"text",children:"文本题"})]})]})})]},t)})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,u.jsx)("button",{type:"button",onClick:function(){return t.back()},style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",background:"white",color:"#374151",cursor:"pointer"},children:"取消"}),(0,u.jsx)("button",{type:"submit",disabled:y,style:{padding:"0.75rem 1.5rem",background:"#10b981",color:"white",border:"none",borderRadius:"0.375rem",cursor:y?"not-allowed":"pointer",opacity:y?.6:1},children:y?"保存中...":"保存修改"})]})]})]})})}},1163:function(e,t,r){e.exports=r(387)},943:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},7568:function(e,t,r){"use strict";function n(e,t,r,n,i,o,s){try{var a=e[o](s),d=a.value}catch(u){r(u);return}a.done?t(d):Promise.resolve(d).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function a(e){n(s,i,o,a,d,"next",e)}function d(e){n(s,i,o,a,d,"throw",e)}a(void 0)})}}r.d(t,{Z:function(){return i}})},3375:function(e,t,r){"use strict";function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}r.d(t,{Z:function(){return n}})},9396:function(e,t,r){"use strict";function n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}r.d(t,{Z:function(){return n}})},9815:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(943),i=r(3375),o=r(1566);function s(e){return function(e){if(Array.isArray(e))return(0,n.Z)(e)}(e)||(0,i.Z)(e)||(0,o.Z)(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1566:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(943);function i(e,t){if(e){if("string"==typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return(0,n.Z)(e,t)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9934)}),_N_E=e.O()}]);