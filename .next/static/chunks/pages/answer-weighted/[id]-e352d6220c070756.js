(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{2154:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/answer-weighted/[id]",function(){return t(3804)}])},3804:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var a=t(7568),n=t(4924),s=t(6042),i=t(9396),o=t(828),c=t(7582),l=t(5893),d=t(357),m=t.n(d),f=t(7294),u=t(1163);function b(){var e,r=(0,u.useRouter)(),t=r.query.id,d=(0,f.useState)(!0),b=d[0],x=d[1],h=(0,f.useState)(!1),p=h[0],g=h[1],y=(0,f.useState)(""),j=y[0],v=y[1],k=(0,f.useState)(null),w=k[0],N=k[1],S=(0,f.useState)({}),z=S[0],I=S[1],C=(0,f.useState)(null),_=C[0],R=C[1];(0,f.useEffect)(function(){t&&B()},[t]);var T,B=(e=(0,a.Z)(function(){var e,r;return(0,c.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,4,5]),x(!0),[4,fetch("/api/surveys/weighted/".concat(t))];case 1:return[4,e.sent().json()];case 2:return(r=e.sent()).success?N(r.data.survey):v(r.message||"问卷不存在或已过期"),[3,5];case 3:return e.sent(),v("网络错误，请稍后重试"),[3,5];case 4:return x(!1),[7];case 5:return[2]}})}),function(){return e.apply(this,arguments)}),W=function(e,r){I(function(t){return(0,i.Z)((0,s.Z)({},t),(0,n.Z)({},e,r))})},E=(T=(0,a.Z)(function(e){var t,a,n,s,i;return(0,c.__generator)(this,function(t){switch(t.label){case 0:if(e.preventDefault(),!w)return[2];if((a=w.projects.flatMap(function(e){return e.dimensions}).filter(function(e){return!z[e.id]})).length>0)return v("请完成所有维度的评分：".concat(a.map(function(e){return e.content}).join("、"))),[2];t.label=1;case 1:return t.trys.push([1,4,5,6]),g(!0),v(""),[4,fetch("/api/surveys/submit-weighted",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({surveyId:w.id,answers:Object.entries(z).map(function(e){var r,t=(0,o.Z)(e,2);return{dimensionId:t[0],optionId:t[1]}})})})];case 2:return[4,t.sent().json()];case 3:return(s=t.sent()).success?(i=encodeURIComponent(JSON.stringify(s.data.projectScores)),r.push("/thank-you?surveyId=".concat(w.id,"&projectScores=").concat(i))):v(s.message||"提交失败，请重试"),[3,6];case 4:return t.sent(),v("网络错误，请稍后重试"),[3,6];case 5:return g(!1),[7];case 6:return[2]}})}),function(e){return T.apply(this,arguments)}),D=function(e){var r=z[e];if(!r)return null;var t=!0,a=!1,n=void 0;try{for(var s,i=((null==w?void 0:w.projects)||[])[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var o=s.value,c=!0,l=!1,d=void 0;try{for(var m,f=o.dimensions[Symbol.iterator]();!(c=(m=f.next()).done);c=!0){var u=m.value;if(u.id===e)return u.options.find(function(e){return e.id===r})}}catch(b){l=!0,d=b}finally{try{c||null==f.return||f.return()}finally{if(l)throw d}}}}catch(x){a=!0,n=x}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return null};return b?(0,l.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),(0,l.jsx)("p",{style:{color:"#6b7280"},children:"加载中..."})]})}):j||!w?(0,l.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"❌"}),(0,l.jsx)("p",{style:{color:"#ef4444"},children:j||"问卷不存在"}),(0,l.jsx)("button",{onClick:function(){return r.push("/")},style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500",marginTop:"1rem"},children:"返回首页"})]})}):(0,l.jsxs)("div",{style:{minHeight:"100vh",background:"#f8fafc",fontFamily:"sans-serif"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsxs)("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"2rem 1rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",marginBottom:"1rem"},className:"jsx-bfa606d80340ea33",children:w.title}),w.description&&(0,l.jsx)("p",{style:{color:"#6b7280",fontSize:"1.125rem",lineHeight:"1.6"},className:"jsx-bfa606d80340ea33",children:w.description}),w.expiresAt&&(0,l.jsxs)("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"0.5rem",color:"#0369a1"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("strong",{className:"jsx-bfa606d80340ea33",children:"截止时间："}),new Date(w.expiresAt).toLocaleDateString("zh-CN")]})]}),j&&(0,l.jsx)("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.5rem",marginBottom:"2rem"},className:"jsx-bfa606d80340ea33",children:j}),(0,l.jsx)("form",{onSubmit:E,className:"jsx-bfa606d80340ea33",children:(0,l.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"2rem"},className:"jsx-bfa606d80340ea33",children:"请对以下项目进行评分"}),w.projects.map(function(e,r){return(0,l.jsxs)("div",{style:{marginBottom:"2.5rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsxs)("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.5rem",padding:"1rem 1.5rem",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem"},className:"jsx-bfa606d80340ea33",children:[e.imageUrl&&(0,l.jsx)("img",{src:e.imageUrl,alt:"项目图片",onClick:function(){return R({src:e.imageUrl,alt:"".concat(e.content," - 项目图片")})},style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"0.375rem",border:"1px solid #e5e7eb",cursor:"pointer",transition:"transform 0.2s"},onMouseEnter:function(e){e.currentTarget.style.transform="scale(1.05)"},onMouseLeave:function(e){e.currentTarget.style.transform="scale(1)"},className:"jsx-bfa606d80340ea33"}),(0,l.jsxs)("div",{className:"jsx-bfa606d80340ea33",children:[(0,l.jsxs)("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",margin:0,marginBottom:"0.25rem"},className:"jsx-bfa606d80340ea33",children:[r+1,". ",e.content]}),e.imageUrl&&(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},className:"jsx-bfa606d80340ea33",children:"\uD83D\uDCF7 已上传项目图片"})]})]}),(0,l.jsx)("div",{style:{paddingLeft:"1rem"},className:"jsx-bfa606d80340ea33",children:e.dimensions.map(function(e,r){var t,a;return(0,l.jsxs)("div",{style:{marginBottom:"1.5rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("div",{style:{width:"24px",height:"24px",background:"#3b82f6",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"600",marginRight:"0.75rem"},className:"jsx-bfa606d80340ea33",children:r+1}),(0,l.jsx)("h4",{style:{fontSize:"1.125rem",fontWeight:"500",color:"#374151",margin:0},className:"jsx-bfa606d80340ea33",children:e.content}),(0,l.jsxs)("span",{style:{marginLeft:"auto",fontSize:"0.875rem",color:"#6b7280"},className:"jsx-bfa606d80340ea33",children:["权重: ",100*e.weight,"%"]})]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"0.75rem"},className:"jsx-bfa606d80340ea33",children:e.options.map(function(r){var t=z[e.id]===r.id;return(0,l.jsxs)("label",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"1rem",border:"2px solid",borderColor:t?"#3b82f6":"#d1d5db",borderRadius:"0.5rem",background:t?"#f0f9ff":"white",cursor:"pointer",transition:"all 0.2s"},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("input",{type:"radio",name:"dimension_".concat(e.id),value:r.id,checked:t,onChange:function(){return W(e.id,r.id)},style:{display:"none"},className:"jsx-bfa606d80340ea33"}),(0,l.jsxs)("div",{style:{fontSize:"1.5rem",fontWeight:"600",color:t?"#3b82f6":"#374151",marginBottom:"0.5rem"},className:"jsx-bfa606d80340ea33",children:[r.score,"分"]}),(0,l.jsx)("div",{style:{fontSize:"0.875rem",color:t?"#3b82f6":"#6b7280"},className:"jsx-bfa606d80340ea33",children:r.content})]},r.id)})}),D(e.id)&&(0,l.jsxs)("div",{style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"0.375rem",fontSize:"0.875rem",color:"#0369a1"},className:"jsx-bfa606d80340ea33",children:["当前选择: ",null===(t=D(e.id))||void 0===t?void 0:t.score,"分 - ",null===(a=D(e.id))||void 0===a?void 0:a.content]})]},e.id)})})]},e.id)}),(0,l.jsx)("div",{style:{textAlign:"center",marginTop:"2rem"},className:"jsx-bfa606d80340ea33",children:(0,l.jsx)("button",{type:"submit",disabled:p,style:{background:p?"#9ca3af":"#10b981",color:"white",padding:"1rem 2rem",border:"none",borderRadius:"0.5rem",cursor:p?"not-allowed":"pointer",fontSize:"1.125rem",fontWeight:"600",minWidth:"200px"},className:"jsx-bfa606d80340ea33",children:p?"提交中...":"提交评分"})})]})})]}),_&&(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"fadeIn 0.3s ease-out"},onClick:function(){return R(null)},className:"jsx-bfa606d80340ea33",children:(0,l.jsxs)("div",{style:{position:"relative",maxWidth:"90vw",maxHeight:"90vh",background:"white",borderRadius:"0.75rem",overflow:"hidden",boxShadow:"0 20px 25px rgba(0, 0, 0, 0.3)",animation:"scaleIn 0.3s ease-out"},onClick:function(e){return e.stopPropagation()},className:"jsx-bfa606d80340ea33",children:[(0,l.jsx)("button",{onClick:function(){return R(null)},style:{position:"absolute",top:"1rem",right:"1rem",background:"rgba(0, 0, 0, 0.7)",color:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.25rem",zIndex:10,transition:"background 0.2s"},onMouseEnter:function(e){e.currentTarget.style.background="rgba(0, 0, 0, 0.9)"},onMouseLeave:function(e){e.currentTarget.style.background="rgba(0, 0, 0, 0.7)"},className:"jsx-bfa606d80340ea33",children:"\xd7"}),(0,l.jsx)("img",{src:_.src,alt:_.alt,style:{width:"100%",height:"100%",objectFit:"contain",display:"block"},className:"jsx-bfa606d80340ea33"}),(0,l.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"1rem",textAlign:"center",fontSize:"0.875rem"},className:"jsx-bfa606d80340ea33",children:_.alt})]})}),(0,l.jsx)(m(),{id:"bfa606d80340ea33",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes scaleIn{from{opacity:0;-webkit-transform:scale(.8);transform:scale(.8)}to{opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@-moz-keyframes scaleIn{from{opacity:0;-moz-transform:scale(.8);transform:scale(.8)}to{opacity:1;-moz-transform:scale(1);transform:scale(1)}}@-o-keyframes scaleIn{from{opacity:0;-o-transform:scale(.8);transform:scale(.8)}to{opacity:1;-o-transform:scale(1);transform:scale(1)}}@keyframes scaleIn{from{opacity:0;-webkit-transform:scale(.8);-moz-transform:scale(.8);-o-transform:scale(.8);transform:scale(.8)}to{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}"})]})}}},function(e){e.O(0,[729,774,888,179],function(){return e(e.s=2154)}),_N_E=e.O()}]);