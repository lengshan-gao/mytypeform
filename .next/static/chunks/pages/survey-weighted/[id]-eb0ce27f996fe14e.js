(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{3764:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/survey-weighted/[id]",function(){return r(947)}])},947:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7568),i=r(828),o=r(9815),s=r(7582),d=r(5893),c=r(7294),l=r(1163),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[{main:"#3b82f6",light:"#60a5fa"},{main:"#10b981",light:"#34d399"},{main:"#f59e0b",light:"#fbbf24"},{main:"#ef4444",light:"#f87171"},{main:"#8b5cf6",light:"#a78bfa"},{main:"#06b6d4",light:"#22d3ee"},{main:"#f97316",light:"#fdba74"},{main:"#84cc16",light:"#a3e635"}],n=e%r.length;return t?r[n].light:r[n].main};function u(){var e,t=(0,l.useRouter)(),r=t.query.id,u=(0,c.useState)(!0),f=u[0],m=u[1],h=(0,c.useState)(""),g=h[0],p=h[1],x=(0,c.useState)(null),b=x[0],y=x[1],j=(0,c.useState)([]),v=j[0],S=j[1],w=(0,c.useState)([]),k=w[0],D=w[1];(0,c.useEffect)(function(){r&&A()},[r]);var A=(e=(0,n.Z)(function(){var e,t,n,i,o;return(0,s.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,6,7]),m(!0),[4,fetch("/api/surveys/weighted/".concat(r))];case 1:case 3:return[4,e.sent().json()];case 2:if(!(t=e.sent()).success)return p(t.message||"问卷不存在"),[2];return y(t.data.survey),[4,fetch("/api/surveys/weighted-responses?id=".concat(r))];case 4:return(i=e.sent()).success?(S(i.data.responses||[]),z(i.data.responses||[])):(S([]),D([])),[3,7];case 5:return o=e.sent(),console.error("获取问卷数据失败:",o),p("网络错误，请稍后重试"),[3,7];case 6:return m(!1),[7];case 7:return[2]}})}),function(){return e.apply(this,arguments)}),z=function(e){var t=new Map;e.forEach(function(e){if(e.question.parent){var r=e.question.parent.content,n=e.option.score*e.question.weight;if(t.has(r)){var i=t.get(r);i.totalScore+=n}else t.set(r,{name:r,totalScore:n})}}),D(Array.from(t.entries()).map(function(e,t){var r=(0,i.Z)(e,2),n=(r[0],r[1]);return{projectId:"project_".concat(t+1),projectName:n.name,score:Math.round(100*n.totalScore)/100}}))},B=function(){A()};return f?(0,d.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"⏳"}),(0,d.jsx)("p",{style:{color:"#6b7280"},children:"加载中..."})]})}):g||!b?(0,d.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"sans-serif"},children:(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"❌"}),(0,d.jsx)("p",{style:{color:"#ef4444"},children:g||"问卷不存在"}),(0,d.jsx)("button",{onClick:function(){return t.push("/surveys")},style:{background:"#3b82f6",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500",marginTop:"1rem"},children:"返回问卷列表"})]})}):(0,d.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",fontFamily:"sans-serif"},children:(0,d.jsxs)("div",{style:{maxWidth:"1000px",margin:"0 auto",padding:"2rem 1rem"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("button",{onClick:function(){return t.push("/surveys")},style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"1rem",display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:"← 返回问卷列表"}),(0,d.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937",margin:0},children:b.title}),b.description&&(0,d.jsx)("p",{style:{color:"#6b7280",marginTop:"0.5rem",fontSize:"1.125rem"},children:b.description})]}),(0,d.jsx)("button",{onClick:B,style:{background:"#10b981",color:"white",padding:"0.75rem 1.5rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"\uD83D\uDD04 重新计算"})]}),(0,d.jsx)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"1.5rem",marginBottom:"2rem"},children:(0,d.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"#3b82f6"},children:v.length}),(0,d.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:"总回答数"})]}),(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"#10b981"},children:k.length}),(0,d.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:"项目数量"})]})]})}),k.length>0?(0,d.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,d.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1.5rem",textAlign:"center"},children:"\uD83D\uDCCA 项目得分对比图"}),(0,d.jsx)("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"center",height:"200px",gap:"2rem",marginBottom:"2rem",padding:"0 1rem"},children:k.map(function(e,t){var r,n=(r=Math).max.apply(r,(0,o.Z)(k.map(function(e){return e.score})).concat([10])),i=Math.min(e.score/n*80,100);return(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,maxWidth:"120px"},children:[(0,d.jsxs)("div",{style:{width:"60px",height:"".concat(i,"%"),background:"linear-gradient(to top, ".concat(a(t),", ").concat(a(t,!0),")"),borderRadius:"4px 4px 0 0",display:"flex",alignItems:"flex-end",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.875rem",paddingBottom:"0.5rem",marginBottom:"0.5rem",position:"relative"},children:[e.score.toFixed(1),(0,d.jsxs)("div",{style:{position:"absolute",top:"-25px",left:"50%",transform:"translateX(-50%)",fontSize:"0.75rem",color:"#374151",fontWeight:"600",whiteSpace:"nowrap"},children:[e.score.toFixed(2),"分"]})]}),(0,d.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#374151",textAlign:"center",lineHeight:"1.2",maxWidth:"100px",wordBreak:"break-word"},children:e.projectName}),(0,d.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:["项目",t+1]})]},e.projectId)})}),(0,d.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",overflow:"hidden"},children:(0,d.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{style:{background:"#f8fafc"},children:[(0,d.jsx)("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600",color:"#374151",borderBottom:"1px solid #e5e7eb"},children:"项目名称"}),(0,d.jsx)("th",{style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#374151",borderBottom:"1px solid #e5e7eb"},children:"得分"}),(0,d.jsx)("th",{style:{padding:"1rem",textAlign:"center",fontWeight:"600",color:"#374151",borderBottom:"1px solid #e5e7eb"},children:"排名"})]})}),(0,d.jsx)("tbody",{children:k.sort(function(e,t){return t.score-e.score}).map(function(e,t){return(0,d.jsxs)("tr",{style:{background:t%2==0?"#ffffff":"#f8fafc"},children:[(0,d.jsx)("td",{style:{padding:"1rem",borderBottom:"1px solid #f1f5f9",fontWeight:"500"},children:e.projectName}),(0,d.jsxs)("td",{style:{padding:"1rem",textAlign:"center",borderBottom:"1px solid #f1f5f9",fontWeight:"600",color:"#1e40af"},children:[e.score.toFixed(2)," 分"]}),(0,d.jsxs)("td",{style:{padding:"1rem",textAlign:"center",borderBottom:"1px solid #f1f5f9",fontWeight:"600",color:0===t?"#dc2626":1===t?"#f59e0b":"#6b7280"},children:[t+1,0===t&&" \uD83E\uDD47",1===t&&" \uD83E\uDD48",2===t&&" \uD83E\uDD49"]})]},e.projectId)})})]})}),(0,d.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"0.5rem",fontSize:"0.875rem",color:"#166534"},children:[(0,d.jsx)("strong",{children:"得分计算说明："})," 每个项目得分 = Σ(维度选项分数 \xd7 维度权重)",(0,d.jsx)("br",{}),(0,d.jsx)("strong",{children:"数据来源："}),' 实时计算所有回答记录，点击"重新计算"按钮更新最新数据']})]}):(0,d.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"3rem",textAlign:"center",marginBottom:"2rem"},children:[(0,d.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"\uD83D\uDCCA"}),(0,d.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"暂无回答数据"}),(0,d.jsx)("p",{style:{color:"#6b7280",marginBottom:"2rem"},children:"当前问卷还没有收到任何回答，请分享问卷链接收集数据。"}),(0,d.jsx)("button",{onClick:function(){return t.push("/surveys")},style:{background:"#3b82f6",color:"white",padding:"0.75rem 2rem",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontSize:"1rem",fontWeight:"500"},children:"复制问卷链接"})]}),v.length>0&&(0,d.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem"},children:[(0,d.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1.5rem"},children:"\uD83D\uDCDD 回答记录"}),(0,d.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:v.map(function(e,t){var r;return(0,d.jsx)("div",{style:{padding:"1rem",border:"1px solid #e5e7eb",borderRadius:"0.5rem",marginBottom:"0.75rem",background:"#f9fafb"},children:(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("strong",{style:{color:"#374151"},children:[(null===(r=e.question.parent)||void 0===r?void 0:r.content)||"未知项目"," - ",e.question.content]}),(0,d.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.25rem"},children:["选择: ",e.option.score,"分 (权重: ",e.question.weight,")"]})]}),(0,d.jsxs)("div",{style:{background:"#dbeafe",color:"#1e40af",padding:"0.25rem 0.75rem",borderRadius:"1rem",fontSize:"0.75rem",fontWeight:"500"},children:["得分: ",(e.option.score*e.question.weight).toFixed(2)]})]})},t)})})]})]})})}},1163:function(e,t,r){e.exports=r(387)},943:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},7568:function(e,t,r){"use strict";function n(e,t,r,n,i,o,s){try{var d=e[o](s),c=d.value}catch(l){r(l);return}d.done?t(c):Promise.resolve(c).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function d(e){n(s,i,o,d,c,"next",e)}function c(e){n(s,i,o,d,c,"throw",e)}d(void 0)})}}r.d(t,{Z:function(){return i}})},3375:function(e,t,r){"use strict";function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}r.d(t,{Z:function(){return n}})},828:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(3375),i=r(1566);function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||(0,n.Z)(e,t)||(0,i.Z)(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},9815:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(943),i=r(3375),o=r(1566);function s(e){return function(e){if(Array.isArray(e))return(0,n.Z)(e)}(e)||(0,i.Z)(e)||(0,o.Z)(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1566:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(943);function i(e,t){if(e){if("string"==typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return(0,n.Z)(e,t)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=3764)}),_N_E=e.O()}]);