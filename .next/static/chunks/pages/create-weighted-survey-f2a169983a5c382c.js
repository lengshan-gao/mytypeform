(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[52],{4187:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/create-weighted-survey",function(){return n(4633)}])},4633:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(7568),o=n(4924),i=n(6042),s=n(9396),d=n(9815),c=n(7582),a=n(5893),l=n(7294),u=n(1163);function m(){var e,t,n=(0,u.useRouter)(),m=(0,l.useState)(!1),f=m[0],p=m[1],h=(0,l.useState)(""),g=h[0],b=h[1],y=(0,l.useState)(""),x=y[0],_=y[1],j=(0,l.useState)(null),v=j[0],w=j[1],S=(0,l.useState)({title:"",description:"",expiresAt:""}),Z=S[0],k=S[1],z=(0,l.useState)([{id:"project_1",content:"项目一",dimensions:[{id:"dimension_1_1",content:"维度A",weight:.1,options:[{id:"option_1_1_1",content:"1分",score:1},{id:"option_1_1_2",content:"3分",score:3},{id:"option_1_1_3",content:"9分",score:9},]},{id:"dimension_1_2",content:"维度B",weight:.3,options:[{id:"option_1_2_1",content:"1分",score:1},{id:"option_1_2_2",content:"3分",score:3},{id:"option_1_2_3",content:"9分",score:9},]},{id:"dimension_1_3",content:"维度C",weight:.2,options:[{id:"option_1_3_1",content:"1分",score:1},{id:"option_1_3_2",content:"3分",score:3},{id:"option_1_3_3",content:"9分",score:9},]},{id:"dimension_1_4",content:"维度D",weight:.2,options:[{id:"option_1_4_1",content:"1分",score:1},{id:"option_1_4_2",content:"3分",score:3},{id:"option_1_4_3",content:"9分",score:9},]},{id:"dimension_1_5",content:"维度E",weight:.2,options:[{id:"option_1_5_1",content:"1分",score:1},{id:"option_1_5_2",content:"3分",score:3},{id:"option_1_5_3",content:"9分",score:9},]}]}]),C=z[0],B=z[1],R=function(e){var t=e.target,n=t.name,r=t.value;k(function(e){return(0,s.Z)((0,i.Z)({},e),(0,o.Z)({},n,r))})},O=function(e,t){B(function(n){return n.map(function(n){return n.id===e?(0,s.Z)((0,i.Z)({},n),{content:t}):n})})},A=function(e,t,n){B(function(r){return r.map(function(r){return r.id===e?(0,s.Z)((0,i.Z)({},r),{dimensions:r.dimensions.map(function(e){return e.id===t?(0,s.Z)((0,i.Z)({},e),{content:n}):e})}):r})})},W=function(e,t,n){B(function(r){return r.map(function(r){return r.id===e?(0,s.Z)((0,i.Z)({},r),{dimensions:r.dimensions.map(function(e){return e.id===t?(0,s.Z)((0,i.Z)({},e),{weight:n}):e})}):r})})},T=(e=(0,r.Z)(function(e,t){var n,r,o;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,4,5]),w(e),(n=new FormData).append("image",t),[4,fetch("/api/upload",{method:"POST",body:n})];case 1:return[4,r.sent().json()];case 2:return(o=r.sent()).success?B(function(t){return t.map(function(t){return t.id===e?(0,s.Z)((0,i.Z)({},t),{imageUrl:o.data.imageUrl}):t})}):b(o.message||"图片上传失败"),[3,5];case 3:return r.sent(),b("图片上传失败，请稍后重试"),[3,5];case 4:return w(null),[7];case 5:return[2]}})}),function(t,n){return e.apply(this,arguments)}),P=function(e){B(function(t){return t.map(function(t){return t.id===e?(0,s.Z)((0,i.Z)({},t),{imageUrl:void 0}):t})})},I=function(){var e="project_".concat(Date.now());B(function(t){return(0,d.Z)(t).concat([{id:e,content:"项目".concat(t.length+1),dimensions:[{id:"dimension_".concat(e,"_1"),content:"维度A",weight:.1,options:[{id:"option_".concat(e,"_1_1"),content:"1分",score:1},{id:"option_".concat(e,"_1_2"),content:"3分",score:3},{id:"option_".concat(e,"_1_3"),content:"9分",score:9},]}]}])})},D=function(e){B(function(t){return t.map(function(t){return t.id===e?(0,s.Z)((0,i.Z)({},t),{dimensions:(0,d.Z)(t.dimensions).concat([{id:"dimension_".concat(e,"_").concat(t.dimensions.length+1),content:"维度".concat(String.fromCharCode(65+t.dimensions.length)),weight:.1,options:[{id:"option_".concat(e,"_").concat(t.dimensions.length+1,"_1"),content:"1分",score:1},{id:"option_".concat(e,"_").concat(t.dimensions.length+1,"_2"),content:"3分",score:3},{id:"option_".concat(e,"_").concat(t.dimensions.length+1,"_3"),content:"9分",score:9},]}])}):t})})},E=function(e){if(C.length<=1){alert("至少需要保留一个项目");return}B(function(t){return t.filter(function(t){return t.id!==e})})},F=function(e,t){B(function(n){return n.map(function(n){return n.id===e?(0,s.Z)((0,i.Z)({},n),{dimensions:n.dimensions.filter(function(e){return e.id!==t})}):n})})},N=(t=(0,r.Z)(function(e){var t,r,o,d,a,l,u,m,f,h,g;return(0,c.__generator)(this,function(c){switch(c.label){case 0:e.preventDefault(),c.label=1;case 1:if(c.trys.push([1,4,5,6]),p(!0),b(""),_(""),!Z.title.trim())return b("请输入问卷标题"),[2];t=!0,r=!1,o=void 0;try{for(d=C[Symbol.iterator]();!(t=(a=d.next()).done);t=!0)if(u=(l=a.value).dimensions.reduce(function(e,t){return e+t.weight},0),Math.abs(u-1)>.001)return b('项目"'.concat(l.content,'"的维度权重总和必须为1，当前为').concat(u)),[2]}catch(h){r=!0,o=h}finally{try{t||null==d.return||d.return()}finally{if(r)throw o}}if(!(m=localStorage.getItem("token")))return b("请先登录"),n.push("/login?returnTo=/create-weighted-survey"),[2];return f=(0,s.Z)((0,i.Z)({},Z),{expiresAt:Z.expiresAt.trim()?Z.expiresAt:null}),[4,fetch("/api/surveys/create-weighted",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)},body:JSON.stringify((0,s.Z)((0,i.Z)({},f),{projects:C}))})];case 2:return[4,c.sent().json()];case 3:return(g=c.sent()).success?(_("权重计算问卷创建成功！"),setTimeout(function(){n.push("/surveys")},2e3)):b(g.message||"创建失败"),[3,6];case 4:return c.sent(),b("网络错误，请稍后重试"),[3,6];case 5:return p(!1),[7];case 6:return[2]}})}),function(e){return t.apply(this,arguments)});return(0,a.jsx)("div",{style:{minHeight:"100vh",background:"#f8fafc",fontFamily:"sans-serif"},children:(0,a.jsxs)("div",{style:{maxWidth:"1000px",margin:"0 auto",padding:"2rem 1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:[(0,a.jsx)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:"#1f2937"},children:"创建权重计算问卷"}),(0,a.jsx)("button",{onClick:function(){return n.back()},style:{padding:"0.5rem 1rem",background:"#6b7280",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"返回"})]}),x&&(0,a.jsx)("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",color:"#16a34a",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1.5rem"},children:x}),g&&(0,a.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1.5rem"},children:g}),(0,a.jsxs)("form",{onSubmit:N,children:[(0,a.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,a.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937",marginBottom:"1.5rem"},children:"问卷基本信息"}),(0,a.jsxs)("div",{style:{display:"grid",gap:"1.5rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷标题 *"}),(0,a.jsx)("input",{type:"text",name:"title",value:Z.title,onChange:R,placeholder:"请输入问卷标题",required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"问卷描述"}),(0,a.jsx)("textarea",{name:"description",value:Z.description,onChange:R,placeholder:"请输入问卷描述",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem",resize:"vertical"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"过期时间（可选）"}),(0,a.jsx)("input",{type:"datetime-local",name:"expiresAt",value:Z.expiresAt,onChange:R,placeholder:"留空表示永不过期",min:new Date().toISOString().slice(0,16),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}}),(0,a.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.25rem"},children:"留空表示问卷永不过期，设置过期时间请选择未来日期"})]})]})]}),(0,a.jsxs)("div",{style:{background:"white",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",padding:"2rem",marginBottom:"2rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1.5rem"},children:[(0,a.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1f2937"},children:["项目配置 (",C.length,")"]}),(0,a.jsx)("button",{type:"button",onClick:I,style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:"添加项目"})]}),C.map(function(e,t){return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"1.5rem",marginBottom:"1.5rem",background:"#f9fafb"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[(0,a.jsxs)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1f2937"},children:["项目 ",t+1]}),(0,a.jsx)("button",{type:"button",onClick:function(){return E(e.id)},style:{padding:"0.25rem 0.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"删除项目"})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"项目名称"}),(0,a.jsx)("input",{type:"text",value:e.content,onChange:function(t){return O(e.id,t.target.value)},placeholder:"请输入项目名称",style:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"1rem"}})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"项目图片（可选）"}),e.imageUrl?(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem"},children:[(0,a.jsx)("img",{src:e.imageUrl,alt:"项目预览",style:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"0.5rem",border:"1px solid #e5e7eb"}}),(0,a.jsx)("button",{type:"button",onClick:function(){return P(e.id)},style:{padding:"0.5rem 1rem",background:"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.875rem"},children:"删除图片"})]}):(0,a.jsxs)("div",{style:{border:"2px dashed #d1d5db",borderRadius:"0.5rem",padding:"2rem",textAlign:"center",cursor:"pointer",transition:"border-color 0.2s"},onMouseEnter:function(e){e.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:function(e){e.currentTarget.style.borderColor="#d1d5db"},children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:function(t){var n,r=null===(n=t.target.files)||void 0===n?void 0:n[0];r&&T(e.id,r)},style:{display:"none"},id:"image-upload-".concat(e.id)}),(0,a.jsxs)("label",{htmlFor:"image-upload-".concat(e.id),style:{display:"block",cursor:"pointer"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"\uD83D\uDCF7"}),(0,a.jsx)("div",{style:{color:"#6b7280",fontSize:"0.875rem"},children:v===e.id?"上传中...":"点击上传项目图片"}),(0,a.jsx)("div",{style:{color:"#9ca3af",fontSize:"0.75rem",marginTop:"0.25rem"},children:"支持 JPG、PNG 格式，最大 5MB"})]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[(0,a.jsxs)("h4",{style:{fontSize:"1rem",fontWeight:"600",color:"#374151"},children:["维度配置 (",e.dimensions.length,")"]}),(0,a.jsx)("button",{type:"button",onClick:function(){return D(e.id)},style:{padding:"0.25rem 0.5rem",background:"#10b981",color:"white",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"添加维度"})]}),e.dimensions.map(function(t,n){return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.375rem",padding:"1rem",marginBottom:"1rem",background:"white"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem"},children:[(0,a.jsxs)("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:["维度 ",n+1]}),(0,a.jsx)("button",{type:"button",onClick:function(){return F(e.id,t.id)},style:{padding:"0.25rem 0.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"0.25rem",cursor:"pointer",fontSize:"0.75rem"},children:"删除维度"})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 150px",gap:"1rem",alignItems:"end"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.75rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.25rem"},children:"维度名称"}),(0,a.jsx)("input",{type:"text",value:t.content,onChange:function(n){return A(e.id,t.id,n.target.value)},placeholder:"请输入维度名称",style:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.875rem"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.75rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.25rem"},children:"权重 (0-1)"}),(0,a.jsx)("input",{type:"number",min:"0",max:"1",step:"0.01",value:t.weight,onChange:function(n){return W(e.id,t.id,parseFloat(n.target.value))},style:{width:"100%",padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.25rem",fontSize:"0.875rem"}})]})]}),(0,a.jsxs)("div",{style:{marginTop:"0.75rem"},children:[(0,a.jsx)("label",{style:{display:"block",fontSize:"0.75rem",fontWeight:"500",color:"#6b7280",marginBottom:"0.5rem"},children:"选项配置 (固定3个选项：1分、3分、9分)"}),(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem"},children:t.options.map(function(e,t){return(0,a.jsxs)("div",{style:{padding:"0.5rem",background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"0.25rem",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:e.content}),(0,a.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:["分值: ",e.score,"分"]})]},e.id)})})]})]},t.id)}),(0,a.jsx)("div",{style:{padding:"0.75rem",background:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"0.375rem",marginTop:"1rem"},children:(0,a.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"500",color:"#0369a1"},children:["当前维度权重总和: ",e.dimensions.reduce(function(e,t){return e+t.weight},0).toFixed(2),Math.abs(e.dimensions.reduce(function(e,t){return e+t.weight},0)-1)>.001&&(0,a.jsx)("span",{style:{color:"#dc2626",marginLeft:"0.5rem"},children:"(权重总和必须为1)"})]})})]},e.id)})]}),(0,a.jsx)("div",{style:{textAlign:"center"},children:(0,a.jsx)("button",{type:"submit",disabled:f,style:{background:f?"#9ca3af":"#10b981",color:"white",padding:"1rem 2rem",border:"none",borderRadius:"0.5rem",cursor:f?"not-allowed":"pointer",fontSize:"1.125rem",fontWeight:"600",minWidth:"200px"},children:f?"创建中...":"创建权重计算问卷"})})]})]})})}},1163:function(e,t,n){e.exports=n(387)},943:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},7568:function(e,t,n){"use strict";function r(e,t,n,r,o,i,s){try{var d=e[i](s),c=d.value}catch(a){n(a);return}d.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var s=e.apply(t,n);function d(e){r(s,o,i,d,c,"next",e)}function c(e){r(s,o,i,d,c,"throw",e)}d(void 0)})}}n.d(t,{Z:function(){return o}})},3375:function(e,t,n){"use strict";function r(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},9396:function(e,t,n){"use strict";function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}n.d(t,{Z:function(){return r}})},9815:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(943),o=n(3375),i=n(1566);function s(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,o.Z)(e)||(0,i.Z)(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1566:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(943);function o(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return(0,r.Z)(e,t)}}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4187)}),_N_E=e.O()}]);