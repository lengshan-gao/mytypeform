# Serverless Framework + GitHub éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆä½¿ç”¨ Serverless Framework é€šè¿‡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²æƒé‡é—®å·ç³»ç»Ÿåˆ°è…¾è®¯äº‘å‡½æ•°ã€‚

### ğŸ¯ æ–¹æ¡ˆä¼˜åŠ¿
- âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²**: ä»£ç æ¨é€åˆ°GitHubåè‡ªåŠ¨éƒ¨ç½²
- âœ… **ç¯å¢ƒéš”ç¦»**: æ— éœ€æœ¬åœ°Node.jsç‰ˆæœ¬å‡çº§
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: æ¯æ¬¡éƒ¨ç½²éƒ½æœ‰å®Œæ•´çš„ç‰ˆæœ¬è®°å½•
- âœ… **æŒç»­é›†æˆ**: è‡ªåŠ¨æµ‹è¯•å’Œæ„å»º

## ğŸš€ éƒ¨ç½²å‰å‡†å¤‡

### 1. GitHubä»“åº“å‡†å¤‡
- ä»£ç å·²æ¨é€åˆ°: `lengshan-gao/mytypeform`
- ç¡®ä¿ `master` åˆ†æ”¯åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶

### 2. è…¾è®¯äº‘èµ„æºå‡†å¤‡
- âœ… äº‘å‡½æ•° SCF å®ä¾‹
- âœ… TDSQL-C æ•°æ®åº“å®ä¾‹
- âœ… è…¾è®¯äº‘è´¦æˆ·å‡­è¯

## ğŸ”§ é…ç½®GitHub Secrets

### ç¬¬ä¸€æ­¥ï¼šè¿›å…¥GitHubä»“åº“è®¾ç½®
1. è®¿é—®æ‚¨çš„GitHubä»“åº“: `https://github.com/lengshan-gao/mytypeform`
2. ç‚¹å‡» **Settings** æ ‡ç­¾é¡µ
3. å·¦ä¾§èœå•é€‰æ‹© **Secrets and variables** â†’ **Actions**

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ å¿…è¦çš„Secrets

æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡åˆ°GitHub Secretsï¼š

| Secretåç§° | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------------|------|--------|
| `TENCENT_SECRET_ID` | è…¾è®¯äº‘SecretId | `AKIDRUTKEyiLnAPSL1VozFctPmwugHhuuhJl` |
| `TENCENT_SECRET_KEY` | è…¾è®¯äº‘SecretKey | `PejeMTP9g4JLDuRnyzoQp2axLlIm7IH7` |
| `DATABASE_URL` | TDSQL-Cè¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host:5432/db` |
| `NEXTAUTH_SECRET` | åº”ç”¨å®‰å…¨å¯†é’¥ | `1234567890a_haha` |
| `NEXTAUTH_URL` | åº”ç”¨è®¿é—®åŸŸå | `https://your-function.ap-guangzhou.app.tcloudbase.com` |

### æ·»åŠ Secretsæ­¥éª¤ï¼š
1. ç‚¹å‡» **New repository secret**
2. è¾“å…¥ **Name** (å¦‚: `TENCENT_SECRET_ID`)
3. è¾“å…¥ **Value** (æ‚¨çš„å®é™…å€¼)
4. ç‚¹å‡» **Add secret**

## ğŸ”„ è§¦å‘è‡ªåŠ¨éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šæ¨é€ä»£ç è§¦å‘
```bash
# æœ¬åœ°ä¿®æ”¹ä»£ç å
git add .
git commit -m "éƒ¨ç½²ç›¸å…³é…ç½®"
git push origin master
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨è§¦å‘
1. è¿›å…¥GitHubä»“åº“çš„ **Actions** æ ‡ç­¾é¡µ
2. é€‰æ‹© **Deploy to Tencent Cloud SCF** å·¥ä½œæµ
3. ç‚¹å‡» **Run workflow**
4. é€‰æ‹©åˆ†æ”¯: `master`
5. ç‚¹å‡» **Run workflow**

## ğŸ“Š éƒ¨ç½²æµç¨‹è¯´æ˜

### GitHub Actionsæ‰§è¡Œæ­¥éª¤ï¼š
1. **Checkout code**: æ‹‰å–æœ€æ–°ä»£ç 
2. **Setup Node.js**: é…ç½®Node.js 18ç¯å¢ƒ
3. **Install dependencies**: å®‰è£…é¡¹ç›®ä¾èµ–å’ŒServerless Framework
4. **Configure credentials**: é…ç½®è…¾è®¯äº‘å‡­è¯
5. **Deploy**: æ‰§è¡ŒServerless Frameworkéƒ¨ç½²
6. **Output info**: è¾“å‡ºéƒ¨ç½²ä¿¡æ¯

### éƒ¨ç½²è¿‡ç¨‹åŒ…å«ï¼š
- âœ… å®‰è£…é¡¹ç›®ä¾èµ– (`npm install`)
- âœ… ç”ŸæˆPrismaå®¢æˆ·ç«¯ (`npx prisma generate`)
- âœ… æ„å»ºNext.jsåº”ç”¨ (`npm run build`)
- âœ… éƒ¨ç½²åˆ°è…¾è®¯äº‘å‡½æ•°
- âœ… é…ç½®APIç½‘å…³

## ğŸ› ï¸ éƒ¨ç½²é…ç½®æ–‡ä»¶è¯´æ˜

### 1. `serverless.yml` - ä¸»é…ç½®æ–‡ä»¶
```yaml
component: scf                    # ä½¿ç”¨è…¾è®¯äº‘å‡½æ•°ç»„ä»¶
name: survey-system              # å‡½æ•°åç§°
inputs:
  name: survey-system            # å‡½æ•°åç§°
  region: ap-guangzhou           # åœ°åŸŸ
  runtime: Nodejs16.13           # è¿è¡Œæ—¶
  type: web                      # Webå‡½æ•°ç±»å‹
  memorySize: 1024               # å†…å­˜å¤§å°
  timeout: 60                    # è¶…æ—¶æ—¶é—´
  
  # æ„å»ºé…ç½®
  installDependency: true        # è‡ªåŠ¨å®‰è£…ä¾èµ–
  buildCommand: |                # æ„å»ºå‘½ä»¤
    npm install
    npx prisma generate
    npm run build
  bootstrap: ./scf_bootstrap     # å¯åŠ¨è„šæœ¬
```

### 2. `scf_bootstrap` - å¯åŠ¨è„šæœ¬
```bash
#!/bin/bash
./node_modules/.bin/next start    # å¯åŠ¨Next.jsåº”ç”¨
```

### 3. `.github/workflows/deploy-to-tencent.yml` - GitHub Actionså·¥ä½œæµ
```yaml
name: Deploy to Tencent Cloud SCF
on:
  push:
    branches: [ master ]         # ç›‘å¬masteråˆ†æ”¯æ¨é€
```

## ğŸ” éƒ¨ç½²åéªŒè¯

### 1. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
1. è¿›å…¥GitHubä»“åº“çš„ **Actions** æ ‡ç­¾é¡µ
2. æŸ¥çœ‹æœ€æ–°çš„å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€
3. ç‚¹å‡»å·¥ä½œæµæŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### 2. è…¾è®¯äº‘æ§åˆ¶å°éªŒè¯
1. ç™»å½• [è…¾è®¯äº‘æ§åˆ¶å°](https://console.cloud.tencent.com)
2. è¿›å…¥ **äº‘å‡½æ•° SCF**
3. æŸ¥çœ‹å‡½æ•°çŠ¶æ€å’Œæ—¥å¿—

### 3. åŠŸèƒ½æµ‹è¯•
éƒ¨ç½²å®Œæˆåè®¿é—®ä»¥ä¸‹URLæµ‹è¯•åŠŸèƒ½ï¼š

- **é¦–é¡µ**: `https://æ‚¨çš„åŸŸå/`
- **ç™»å½•é¡µ**: `https://æ‚¨çš„åŸŸå/login`
- **é—®å·åˆ—è¡¨**: `https://æ‚¨çš„åŸŸå/surveys`
- **åˆ›å»ºæƒé‡é—®å·**: `https://æ‚¨çš„åŸŸå/create-weighted-survey`

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: éƒ¨ç½²å¤±è´¥ - å‡­è¯é”™è¯¯
**ç—‡çŠ¶**: GitHub Actionsæ—¥å¿—æ˜¾ç¤ºå‡­è¯éªŒè¯å¤±è´¥
**è§£å†³**: 
- æ£€æŸ¥ `TENCENT_SECRET_ID` å’Œ `TENCENT_SECRET_KEY` æ˜¯å¦æ­£ç¡®
- ç¡®ä¿è…¾è®¯äº‘è´¦æˆ·æœ‰è¶³å¤Ÿçš„æƒé™

### é—®é¢˜2: æ„å»ºå¤±è´¥ - ä¾èµ–å®‰è£…é”™è¯¯
**ç—‡çŠ¶**: `npm install` é˜¶æ®µå¤±è´¥
**è§£å†³**:
- æ£€æŸ¥ `package.json` ä¾èµ–é…ç½®
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### é—®é¢˜3: å‡½æ•°å¯åŠ¨å¤±è´¥
**ç—‡çŠ¶**: éƒ¨ç½²æˆåŠŸä½†è®¿é—®è¿”å›é”™è¯¯
**è§£å†³**:
- æ£€æŸ¥è…¾è®¯äº‘å‡½æ•°æ—¥å¿—
- éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
- ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

### é—®é¢˜4: æ•°æ®åº“è¿æ¥å¤±è´¥
**ç—‡çŠ¶**: åº”ç”¨æ— æ³•è¿æ¥æ•°æ®åº“
**è§£å†³**:
- æ£€æŸ¥ `DATABASE_URL` æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ•°æ®åº“å®‰å…¨ç»„è®¾ç½®
- éªŒè¯æ•°æ®åº“å®ä¾‹çŠ¶æ€

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### 1. ç›‘æ§æŒ‡æ ‡
- **å‡½æ•°æ‰§è¡Œæ¬¡æ•°**: æŸ¥çœ‹è°ƒç”¨é¢‘ç‡
- **æ‰§è¡Œæ—¶é—´**: ç›‘æ§æ€§èƒ½è¡¨ç°
- **é”™è¯¯ç‡**: å…³æ³¨ç¨³å®šæ€§
- **å†…å­˜ä½¿ç”¨**: ä¼˜åŒ–èµ„æºé…ç½®

### 2. æ—¥å¿—æŸ¥çœ‹
```bash
# é€šè¿‡Serverless FrameworkæŸ¥çœ‹æ—¥å¿—
serverless logs -f survey-system

# æˆ–é€šè¿‡è…¾è®¯äº‘æ§åˆ¶å°æŸ¥çœ‹
```

### 3. ç‰ˆæœ¬ç®¡ç†
- æ¯æ¬¡éƒ¨ç½²éƒ½ä¼šåˆ›å»ºæ–°ç‰ˆæœ¬
- æ”¯æŒç‰ˆæœ¬å›æ»š
- ä¿ç•™å†å²éƒ¨ç½²è®°å½•

## ğŸ”„ æ›´æ–°å’Œå›æ»š

### æ›´æ–°åº”ç”¨
```bash
# æœ¬åœ°ä¿®æ”¹ä»£ç 
git add .
git commit -m "åŠŸèƒ½æ›´æ–°"
git push origin master
# è‡ªåŠ¨è§¦å‘éƒ¨ç½²
```

### å›æ»šåˆ°æ—§ç‰ˆæœ¬
1. è¿›å…¥è…¾è®¯äº‘å‡½æ•°æ§åˆ¶å°
2. é€‰æ‹©å‡½æ•° â†’ ç‰ˆæœ¬ç®¡ç†
3. é€‰æ‹©è¦å›æ»šçš„ç‰ˆæœ¬
4. è®¾ç½®ä¸ºå½“å‰ç‰ˆæœ¬

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
1. **GitHub Actionsæ—¥å¿—**: æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
2. **è…¾è®¯äº‘æ§åˆ¶å°**: æŸ¥çœ‹å‡½æ•°çŠ¶æ€å’Œæ—¥å¿—
3. **Serverless Frameworkæ–‡æ¡£**: [å®˜æ–¹æ–‡æ¡£](https://www.serverless.com/framework/docs)

### è”ç³»æ”¯æŒ
- GitHub Issues: åˆ›å»ºissueæè¿°é—®é¢˜
- è…¾è®¯äº‘å·¥å•: é€šè¿‡æ§åˆ¶å°æäº¤å·¥å•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-27  
**é€‚ç”¨ç¯å¢ƒ**: GitHub + è…¾è®¯äº‘å‡½æ•°  
**æŠ€æœ¯æ ˆ**: Next.js + Serverless Framework